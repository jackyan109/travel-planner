<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-image: url("https://d1grca2t3zpuug.cloudfront.net/2025/06/f32837568_m-870x500-1750991180.webp");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.88);
            backdrop-filter: blur(10px);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .top-banner {
            position: sticky;
            top: 0;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            padding: 12px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }

        .countdown-card {
            background: white;
            margin: 10px;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            text-align: center;
        }

        .countdown-title {
            font-size: 18px;
            font-weight: bold;
        }

        .countdown-time {
            font-size: 22px;
            margin-top: 8px;
            font-weight: bold;
            color: #0078ff;
        }

        .countdown-route {
            margin-top: 5px;
            font-size: 14px;
            color: #444;
        }

        header {
            background: #fff;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 120px;
            z-index: 999;
        }

        .container {
            padding: 15px;
        }

        section {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        h2 {
            margin-top: 0;
        }

        input, select, button {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box;
        }

        button {
            background: #0078ff;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #005fcc;
        }

        iframe {
            width: 100%;
            height: 350px;
            border: none;
            border-radius: 10px;
        }

        ul {
            padding-left: 0;
            list-style: none;
        }

        .date-group {
            margin-bottom: 12px;
        }

        .date-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .itinerary-item {
            margin-bottom: 6px;
            padding: 8px;
            background: #f7f7f7;
            border-radius: 6px;
            cursor: grab;
        }

        .itinerary-item.dragging {
            opacity: 0.5;
        }

        .drop-target {
            border: 2px dashed #0078ff;
        }

        #shopping-list li {
            background: #f7f7f7;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 6px;
        }

        #shopping-list img {
            display: block;
            margin-top: 4px;
            max-width: 100px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 480px;
            max-width: 100%;
            background: white;
            border-top: 1px solid #ccc;
            display: flex;
            justify-content: space-around;
            padding: 6px 0;
            z-index: 9999;
        }

        .nav-btn {
            text-align: center;
            font-size: 13px;
            color: #555;
            cursor: pointer;
        }

        .nav-btn span {
            display: block;
        }

        .nav-btn-icon {
            font-size: 18px;
        }

        .nav-btn-label {
            font-size: 12px;
        }

        .nav-btn.active {
            color: #0078ff;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<div class="app-container">

    <div class="top-banner">üáØüáµ Êù±‰∫¨2025-2026</div>

    <div class="countdown-card">
        <div class="countdown-title">‚úàÔ∏è Âá∫ÁôºÂÄíÊï∏</div>
        <div id="countdown" class="countdown-time">Ë®àÁÆó‰∏≠...</div>
        <div class="countdown-route">HKG ‚Üí HND</div>
    </div>

    <header>
        <h1>Travel Planner</h1>
    </header>

    <div class="container">

        <section id="map-section">
            <h2>Âú∞Âúñ Map</h2>
            <label>üìÖ ÈÅ∏ÊìáÊó•ÊúüÔºö</label>
            <select id="map-date-selector"></select>
            <iframe id="map-frame"
                    src="https://www.google.com/maps?q=Tokyo"
                    allowfullscreen>
            </iframe>
        </section>

        <section id="itinerary-section">
            <h2>Ë°åÁ®ã Itinerary</h2>
            <input type="text" id="itinerary-date" placeholder="DD-MM-YYYY">
            <input type="text" id="itinerary-place" placeholder="Âú∞Èªû">
            <button id="add-itinerary">Êñ∞Â¢ûË°åÁ®ã</button>
            <div id="itinerary-list"></div>
        </section>

        <section id="budget-section">
            <h2>È†êÁÆó Budget</h2>
            <input type="number" id="budget-jpy" placeholder="Êó•Âúì JPY">
            <button id="convert-budget">ËΩâÊèõÁÇ∫ HKD</button>
            <p id="budget-result"></p>
        </section>

        <section id="shopping-section">
            <h2>Ë≥ºÁâ©Ê∏ÖÂñÆ Shopping List</h2>
            <input type="text" id="shopping-item" placeholder="Áâ©ÂìÅÂêçÁ®±">
            <input type="file" id="shopping-image">
            <button id="add-shopping">Êñ∞Â¢ûÁâ©ÂìÅ</button>
            <ul id="shopping-list"></ul>
        </section>

    </div>
</div>

<div class="bottom-nav">
    <div class="nav-btn active" data-target="map-section">
        <span class="nav-btn-icon">üìå</span>
        <span class="nav-btn-label">Âú∞Âúñ</span>
    </div>
    <div class="nav-btn" data-target="itinerary-section">
        <span class="nav-btn-icon">üìÖ</span>
        <span class="nav-btn-label">Ë°åÁ®ã</span>
    </div>
    <div class="nav-btn" data-target="budget-section">
        <span class="nav-btn-icon">üí∞</span>
        <span class="nav-btn-label">È†êÁÆó</span>
    </div>
    <div class="nav-btn" data-target="shopping-section">
        <span class="nav-btn-icon">üõçÔ∏è</span>
        <span class="nav-btn-label">Ë≥ºÁâ©</span>
    </div>
</div>

<script>
function loadItineraryFromStorage() {
    const data = localStorage.getItem("itinerary");
    return data ? JSON.parse(data) : {};
}

function saveItineraryToStorage(itinerary) {
    localStorage.setItem("itinerary", JSON.stringify(itinerary));
}

function parseDateDDMMYYYY(dateStr) {
    const [dd, mm, yyyy] = dateStr.split("-").map(Number);
    return new Date(yyyy, mm - 1, dd);
}

function updateMapForDate(date, itinerary) {
    const places = itinerary[date];
    const frame = document.getElementById("map-frame");

    if (!places || places.length === 0) {
        frame.src = "https://www.google.com/maps?q=Tokyo";
        return;
    }

    const query = places.map(p => encodeURIComponent(p)).join("+");
    frame.src = `https://www.google.com/maps?q=${query}`;
}

function initMapDateSelector() {
    const itinerary = loadItineraryFromStorage();
    const selector = document.getElementById("map-date-selector");
    selector.innerHTML = "";

    const dates = Object.keys(itinerary);

    if (dates.length === 0) {
        selector.innerHTML = '<option>Ê≤íÊúâË°åÁ®ã</option>';
        document.getElementById("map-frame").src = "https://www.google.com/maps?q=Tokyo";
        return;
    }

    dates.sort((a, b) => parseDateDDMMYYYY(a) - parseDateDDMMYYYY(b));

    dates.forEach(date => {
        if (!itinerary[date] || itinerary[date].length === 0) return;
        const option = document.createElement("option");
        option.value = date;
        option.textContent = date;
        selector.appendChild(option);
    });

    if (selector.options.length === 0) {
        selector.innerHTML = '<option>Ê≤íÊúâË°åÁ®ã</option>';
        document.getElementById("map-frame").src = "https://www.google.com/maps?q=Tokyo";
        return;
    }

    const firstDate = selector.options[0].value;
    selector.value = firstDate;
    updateMapForDate(firstDate, itinerary);

    selector.onchange = () => {
        const selected = selector.value;
        updateMapForDate(selected, loadItineraryFromStorage());
    };
}

function renderItineraryList() {
    const itinerary = loadItineraryFromStorage();
    const container = document.getElementById("itinerary-list");
    container.innerHTML = "";

    const dates = Object.keys(itinerary).sort((a, b) => parseDateDDMMYYYY(a) - parseDateDDMMYYYY(b));

    dates.forEach(date => {
        const places = itinerary[date];
        if (!places || places.length === 0) return;

        const groupDiv = document.createElement("div");
        groupDiv.className = "date-group";
        groupDiv.dataset.date = date;

        const title = document.createElement("div");
        title.className = "date-title";
        title.textContent = date;
        groupDiv.appendChild(title);

        const list = document.createElement("div");
        list.className = "date-list";

        places.forEach((place, index) => {
            const item = document.createElement("div");
            item.className = "itinerary-item";
            item.draggable = true;
            item.textContent = place;
            item.dataset.index = index;
            item.dataset.date = date;
            list.appendChild(item);
        });

        groupDiv.appendChild(list);
        container.appendChild(groupDiv);
    });

    enableDragAndDrop();
}

function enableDragAndDrop() {
    const items = document.querySelectorAll(".itinerary-item");

    let draggedItem = null;
    let draggedFromDate = null;

    items.forEach(item => {
        item.addEventListener("dragstart", () => {
            draggedItem = item;
            draggedFromDate = item.dataset.date;
            item.classList.add("dragging");
        });

        item.addEventListener("dragend", () => {
            if (draggedItem) draggedItem.classList.remove("dragging");
            draggedItem = null;
            draggedFromDate = null;
            document.querySelectorAll(".date-list").forEach(list => list.classList.remove("drop-target"));
        });
    });

    const lists = document.querySelectorAll(".date-list");

    lists.forEach(list => {
        list.addEventListener("dragover", (e) => {
            e.preventDefault();
            list.classList.add("drop-target");
        });

        list.addEventListener("dragleave", () => {
            list.classList.remove("drop-target");
        });

        list.addEventListener("drop", (e) => {
            e.preventDefault();
            list.classList.remove("drop-target");
            if (!draggedItem) return;

            const children = Array.from(list.querySelectorAll(".itinerary-item"));
            const afterElement = children.find(child => {
                const box = child.getBoundingClientRect();
                return e.clientY < box.top + box.height / 2;
            });

            if (afterElement == null) {
                list.appendChild(draggedItem);
            } else {
                list.insertBefore(draggedItem, afterElement);
            }

            const date = list.parentElement.dataset.date;
            updateItineraryOrder(date);
            initMapDateSelector();
        });
    });
}

function updateItineraryOrder(date) {
    const itinerary = loadItineraryFromStorage();
    const listDiv = document.querySelector(`.date-group[data-date="${date}"] .date-list`);
    const items = listDiv.querySelectorAll(".itinerary-item");

    const newOrder = [];
    items.forEach(item => {
        newOrder.push(item.textContent);
    });

    itinerary[date] = newOrder;
    saveItineraryToStorage(itinerary);
}

function initBottomNav() {
    const navBtns = document.querySelectorAll(".nav-btn");
    const sections = {
        "map-section": document.getElementById("map-section"),
        "itinerary-section": document.getElementById("itinerary-section"),
        "budget-section": document.getElementById("budget-section"),
        "shopping-section": document.getElementById("shopping-section")
    };

    function showSection(id) {
        Object.keys(sections).forEach(key => {
            sections[key].classList.toggle("hidden", key !== id);
        });
    }

    showSection("map-section");

    navBtns.forEach(btn => {
        btn.addEventListener("click", () => {
            navBtns.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            const target = btn.dataset.target;
            showSection(target);
            window.scrollTo({ top: 0, behavior: "smooth" });
        });
    });
}

function initCountdown() {
    const countdownEl = document.getElementById("countdown");

    const departure = new Date(2025, 11, 25, 23, 55);
    const arrival = new Date(2025, 11, 26, 4, 45);

    function update() {
        const now = new Date();

        if (now < departure) {
            const diff = departure - now;
            const sec = Math.floor(diff / 1000);
            const days = Math.floor(sec / 86400);
            const hours = Math.floor((sec % 86400) / 3600);
            const mins = Math.floor((sec % 3600) / 60);
            const s = sec % 60;

            countdownEl.textContent =
                `${days} Â§© ${hours} Â∞èÊôÇ ${mins} ÂàÜ ${s} Áßí`;
        } else if (now >= departure && now < arrival) {
            countdownEl.textContent = "Â∑≤Âá∫ÁôºÔºåÂâçÂæÄÊù±‰∫¨‰∏≠‚Ä¶";
        } else {
            countdownEl.textContent = "Â∑≤ÊäµÈÅîÊù±‰∫¨ HND";
        }
    }

    update();
    setInterval(update, 1000);
}

document.addEventListener("DOMContentLoaded", () => {
    initCountdown();
    initBottomNav();
    initMapDateSelector();
    renderItineraryList();

    const itineraryDateInput = document.getElementById("itinerary-date");
    const itineraryPlaceInput = document.getElementById("itinerary-place");
    const addItineraryBtn = document.getElementById("add-itinerary");

    addItineraryBtn.addEventListener("click", () => {
        const date = itineraryDateInput.value.trim();
        const place = itineraryPlaceInput.value.trim();
        if (!date || !place) return;

        const itinerary = loadItineraryFromStorage();
        if (!itinerary[date]) itinerary[date] = [];
        itinerary[date].push(place);
        saveItineraryToStorage(itinerary);

        itineraryPlaceInput.value = "";
        renderItineraryList();
        initMapDateSelector();
    });

    document.getElementById("convert-budget").addEventListener("click", () => {
        const jpy = Number(document.getElementById("budget-jpy").value);
        if (!jpy) {
            document.getElementById("budget-result").textContent = "";
            return;
        }
        const hkd = (jpy * 0.052).toFixed(2);
        document.getElementById("budget-result").textContent = `HKD $${hkd}`;
    });

    const shoppingList = document.getElementById("shopping-list");
    const addShoppingBtn = document.getElementById("add-shopping");

    addShoppingBtn.addEventListener("click", () => {
        const item = document.getElementById("shopping-item").value.trim();
        const imgFile = document.getElementById("shopping-image").files[0];

        if (!item) return;

        const li = document.createElement("li");
        li.textContent = item;

        if (imgFile) {
            const img = document.createElement("img");
            img.src = URL.createObjectURL(imgFile);
            li.appendChild(img);
        }

        shoppingList.appendChild(li);
        document.getElementById("shopping-item").value = "";
        document.getElementById("shopping-image").value = "";
    });
});
</script>
</body>
</html>
