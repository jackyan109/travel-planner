<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }

        /* âœ… æ–°å¢ï¼šé ‚éƒ¨å°æ¨™é¡Œ */
        .top-banner {
            position: sticky;
            top: 0;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            padding: 12px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }

        header {
            background: #fff;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 48px; /* âœ… ä¸‹ç§»ä»¥é¿é–‹é ‚éƒ¨å°æ¨™é¡Œ */
            z-index: 999;
        }

        .container {
            padding: 15px;
        }

        /* âœ… åœ°åœ–å€å¡Š */
        #map-section {
            margin-top: 20px;
        }

        #map-date-selector {
            margin-bottom: 10px;
            padding: 8px;
            font-size: 16px;
            width: 100%;
        }

        iframe {
            width: 100%;
            height: 350px;
            border: none;
            border-radius: 8px;
        }

        /* ä½ åŸæœ¬çš„ CSS æˆ‘å…¨éƒ¨ä¿ç•™ï¼ˆç•¥ï¼‰ */
    </style>
</head>

<body>

    <!-- âœ… æ–°å¢ï¼šé ‚éƒ¨å°æ¨™é¡Œ -->
    <div class="top-banner">ğŸ‡¯ğŸ‡µ æ±äº¬2025-2026</div>

    <header>
        <h1>Travel Planner</h1>
    </header>

    <div class="container">

        <!-- âœ… æ–°å¢ï¼šåœ°åœ–æ—¥æœŸé¸æ“‡å™¨ -->
        <section id="map-section">
            <h2>åœ°åœ– Map</h2>

            <label>ğŸ“… é¸æ“‡æ—¥æœŸï¼š</label>
            <select id="map-date-selector"></select>

            <iframe id="map-frame"
                src="https://www.google.com/maps?q=Tokyo"
                allowfullscreen>
            </iframe>
        </section>

        <!-- âœ… ä»¥ä¸‹æ˜¯ä½ åŸæœ¬çš„è¡Œç¨‹ / é ç®— / è³¼ç‰©æ¸…å–®å€å¡Šï¼ˆæˆ‘å…¨éƒ¨ä¿ç•™ï¼‰ -->

        <section id="itinerary-section">
            <h2>è¡Œç¨‹ Itinerary</h2>
            <input type="text" id="itinerary-date" placeholder="DD-MM-YYYY">
            <input type="text" id="itinerary-place" placeholder="åœ°é»">
            <button id="add-itinerary">æ–°å¢è¡Œç¨‹</button>
            <ul id="itinerary-list"></ul>
        </section>

        <section id="budget-section">
            <h2>é ç®— Budget</h2>
            <input type="number" id="budget-jpy" placeholder="æ—¥åœ“ JPY">
            <button id="convert-budget">è½‰æ›ç‚º HKD</button>
            <p id="budget-result"></p>
        </section>

        <section id="shopping-section">
            <h2>è³¼ç‰©æ¸…å–® Shopping List</h2>
            <input type="text" id="shopping-item" placeholder="ç‰©å“åç¨±">
            <input type="file" id="shopping-image">
            <button id="add-shopping">æ–°å¢ç‰©å“</button>
            <ul id="shopping-list"></ul>
        </section>

    </div>

  <script>
/* ================================
   âœ… è®€å– localStorage è¡Œç¨‹è³‡æ–™
================================ */
function loadItineraryFromStorage() {
    const data = localStorage.getItem("itinerary");
    return data ? JSON.parse(data) : {};
}

/* ================================
   âœ… å°‡ DD-MM-YYYY è½‰æˆå¯æ’åºæ ¼å¼
================================ */
function parseDateDDMMYYYY(dateStr) {
    const [dd, mm, yyyy] = dateStr.split("-").map(Number);
    return new Date(yyyy, mm - 1, dd);
}

/* ================================
   âœ… ä¾æ—¥æœŸæ›´æ–°åœ°åœ–ï¼ˆå¤šåœ°é»ï¼‰
================================ */
function updateMapForDate(date, itinerary) {
    const places = itinerary[date];

    if (!places || places.length === 0) {
        document.getElementById("map-frame").src =
            "https://www.google.com/maps?q=Tokyo";
        return;
    }

    // âœ… å°‡åœ°é»ç”¨ + é€£æ¥ï¼Œè®“ Google Maps é¡¯ç¤ºå¤šå€‹æ¨™è¨˜
    const query = places.map(p => encodeURIComponent(p)).join("+");

    const url = `https://www.google.com/maps?q=${query}`;

    document.getElementById("map-frame").src = url;
}

/* ================================
   âœ… åˆå§‹åŒ–åœ°åœ–æ—¥æœŸé¸æ“‡å™¨
================================ */
function initMapDateSelector() {
    const itinerary = loadItineraryFromStorage();
    const selector = document.getElementById("map-date-selector");

    selector.innerHTML = ""; // æ¸…ç©º

    const dates = Object.keys(itinerary);

    if (dates.length === 0) {
        selector.innerHTML = `<option>æ²’æœ‰è¡Œç¨‹</option>`;
        return;
    }

    // âœ… ä¾ DD-MM-YYYY æ’åº
    dates.sort((a, b) => parseDateDDMMYYYY(a) - parseDateDDMMYYYY(b));

    // âœ… å¡«å…¥é¸é …
    dates.forEach(date => {
        const option = document.createElement("option");
        option.value = date;
        option.textContent = date;
        selector.appendChild(option);
    });

    // âœ… è‡ªå‹•é¸æ“‡ç¬¬ä¸€å€‹æœ‰è¡Œç¨‹çš„æ—¥æœŸ
    const firstDate = dates[0];
    selector.value = firstDate;

    // âœ… æ›´æ–°åœ°åœ–
    updateMapForDate(firstDate, itinerary);

    // âœ… ç•¶ä½¿ç”¨è€…åˆ‡æ›æ—¥æœŸ â†’ æ›´æ–°åœ°åœ–
    selector.addEventListener("change", () => {
        updateMapForDate(selector.value, itinerary);
    });
}

/* ================================
   âœ… åŸæœ¬çš„åŠŸèƒ½ï¼ˆè¡Œç¨‹ / é ç®— / è³¼ç‰©æ¸…å–®ï¼‰
   âœ… æˆ‘å…¨éƒ¨ä¿ç•™ï¼Œåªè£œä¸Š initMapDateSelector()
================================ */
document.addEventListener("DOMContentLoaded", () => {

    /* âœ… åˆå§‹åŒ–åœ°åœ–æ—¥æœŸé¸æ“‡å™¨ */
    initMapDateSelector();

    /* âœ… ä»¥ä¸‹æ˜¯ä½ åŸæœ¬çš„ JSï¼Œæˆ‘å…¨éƒ¨ä¿ç•™ */

    const itineraryInputDate = document.getElementById("itinerary-date");
    const itineraryInputPlace = document.getElementById("itinerary-place");
    const itineraryList = document.getElementById("itinerary-list");
    const addItineraryBtn = document.getElementById("add-itinerary");

    let itinerary = loadItineraryFromStorage();

    function renderItinerary() {
        itineraryList.innerHTML = "";
        for (const date in itinerary) {
            const places = itinerary[date];
            places.forEach((place, index) => {
                const li = document.createElement("li");
                li.textContent = `${date}: ${place}`;
                itineraryList.appendChild(li);
            });
        }
    }

    addItineraryBtn.addEventListener("click", () => {
        const date = itineraryInputDate.value.trim();
        const place = itineraryInputPlace.value.trim();

        if (!date || !place) return;

        if (!itinerary[date]) itinerary[date] = [];
        itinerary[date].push(place);

        localStorage.setItem("itinerary", JSON.stringify(itinerary));

        renderItinerary();
        initMapDateSelector(); // âœ… æ–°å¢è¡Œç¨‹å¾Œæ›´æ–°åœ°åœ–æ—¥æœŸé¸æ“‡å™¨
    });

    renderItinerary();

    /* âœ… é ç®—æ›ç®— */
    document.getElementById("convert-budget").addEventListener("click", () => {
        const jpy = Number(document.getElementById("budget-jpy").value);
        const hkd = (jpy * 0.052).toFixed(2);
        document.getElementById("budget-result").textContent = `HKD $${hkd}`;
    });

    /* âœ… è³¼ç‰©æ¸…å–® */
    const shoppingList = document.getElementById("shopping-list");
    const addShoppingBtn = document.getElementById("add-shopping");

    addShoppingBtn.addEventListener("click", () => {
        const item = document.getElementById("shopping-item").value.trim();
        const imgFile = document.getElementById("shopping-image").files[0];

        if (!item) return;

        const li = document.createElement("li");
        li.textContent = item;

        if (imgFile) {
            const img = document.createElement("img");
            img.src = URL.createObjectURL(imgFile);
            img.style.width = "80px";
            img.style.marginLeft = "10px";
            li.appendChild(img);
        }

        shoppingList.appendChild(li);
    });

});
</script>

</body>
</html>
